<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“è¨ˆç®—å™¨èˆ‡åŒ¯å‡º (æœ€çµ‚ç‰ˆ)</title>
    <style>
        /* åŸºç¤ CSS æ¨£å¼ (ä¿æŒä¸è®Š) */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
        }

        .container {
            max-width: 900px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h2 {
            color: #333;
            border-bottom: 2px solid #ccc;
            padding-bottom: 10px;
            margin-top: 20px;
        }

        .calculation-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .item-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr; /* ç”¢å“å åƒ¹æ ¼ æ•¸é‡ ç¸½åƒ¹ */
            gap: 10px;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }

        .item-row:last-child {
            border-bottom: none;
        }

        .header-row {
            font-weight: bold;
            background-color: #eef;
            padding: 10px 0;
            border-radius: 4px;
        }

        input[type="number"] {
            width: 90%;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            text-align: right;
        }
        
        .total-area {
            margin-top: 15px;
            padding: 10px;
            background-color: #ffebcc;
            border-radius: 4px;
            font-size: 1.2em;
            font-weight: bold;
            color: #d9534f;
            display: flex;
            justify-content: space-between;
        }

        .total-area > div {
            padding: 0 10px;
        }

        /* æ–°å¢ï¼šå…¨åŸŸç¸½è¨ˆå€å¡Šæ¨£å¼ */
        .grand-total-area {
            margin-top: 30px;
            padding: 20px;
            background-color: #4CAF50; /* ç¶ è‰²èƒŒæ™¯ */
            color: white;
            border-radius: 8px;
            font-size: 1.5em;
            font-weight: bold;
            display: flex;
            justify-content: space-around; /* å¹³å‡åˆ†ä½ˆå…©å€‹ç¸½è¨ˆ */
            border: 3px solid #388E3C;
        }
        .grand-total-area span {
            color: #FFEB3B; /* é»ƒè‰²é«˜äº®æ•¸å­— */
        }
        
        #exportButton {
            padding: 10px 20px;
            background-color: #5cb85c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        
        #exportButton:hover {
            background-color: #4cae4c;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>
        ğŸ›’ å•†å“äº¤æ˜“è¨ˆç®—å™¨
        <button id="exportButton">
            <span style="font-size: 1.2em;">â¬‡ï¸</span> åŒ¯å‡ºåˆ° Excel (CSV)
        </button>
    </h1>

    <div id="creditCardSection" class="calculation-section">
        <h2>ğŸ’³ åˆ·å¡è¨ˆç®—</h2>
        <div class="item-row header-row">
            <span>ç”¢å“åç¨±</span>
            <span>åƒ¹æ ¼</span>
            <span>æ•¸é‡</span>
            <span>ç¸½åƒ¹</span>
        </div>
        <div class="item-list" data-type="credit">
            <div class="item-row">
                <span class="product-name">ä¸ƒæ˜Ÿæ¿ƒ</span>
                <input type="number" class="price" data-type="credit" value="0" min="0">
                <input type="number" class="quantity" data-type="credit" value="0" min="0">
                <input type="number" class="subtotal" data-type="credit" value="0" readonly>
            </div>
             <div class="item-row">
                <span class="product-name">ä¸ƒæ˜Ÿä¸­æ·¡</span>
                <input type="number" class="price" data-type="credit" value="0" min="0">
                <input type="number" class="quantity" data-type="credit" value="0" min="0">
                <input type="number" class="subtotal" data-type="credit" value="0" readonly>
            </div>
            <div class="item-row">
                <span class="product-name">ä¸ƒæ˜Ÿè¶…æ·¡</span>
                <input type="number" class="price" data-type="credit" value="0" min="0">
                <input type="number" class="quantity" data-type="credit" value="0" min="0">
                <input type="number" class="subtotal" data-type="credit" value="0" readonly>
            </div>
            <div class="item-row">
                <span class="product-name">ä¸ƒæ˜Ÿè—è“5è™Ÿ</span>
                <input type="number" class="price" data-type="credit" value="0" min="0">
                <input type="number" class="quantity" data-type="credit" value="0" min="0">
                <input type="number" class="subtotal" data-type="credit" value="0" readonly>
            </div>
            <div class="item-row">
                <span class="product-name">ä¸ƒæ˜Ÿè—è“8è™Ÿ</span>
                <input type="number" class="price" data-type="credit" value="0" min="0">
                <input type="number" class="quantity" data-type="credit" value="0" min="0">
                <input type="number" class="subtotal" data-type="credit" value="0" readonly>
            </div>
            <div class="item-row">
                <span class="product-name">å¤©é¦™5è™Ÿ</span>
                <input type="number" class="price" data-type="credit" value="0" min="0">
                <input type="number" class="quantity" data-type="credit" value="0" min="0">
                <input type="number" class="subtotal" data-type="credit" value="0" readonly>
            </div>
            <div class="item-row">
                <span class="product-name">å¡æ–¯ç‰¹3</span>
                <input type="number" class="price" data-type="credit" value="0" min="0">
                <input type="number" class="quantity" data-type="credit" value="0" min="0">
                <input type="number" class="subtotal" data-type="credit" value="0" readonly>
            </div>
            <div class="item-row">
                <span class="product-name">å¡æ–¯ç‰¹5</span>
                <input type="number" class="price" data-type="credit" value="0" min="0">
                <input type="number" class="quantity" data-type="credit" value="0" min="0">
                <input type="number" class="subtotal" data-type="credit" value="0" readonly>
            </div>
            <div class="item-row">
                <span class="product-name">å¡æ–¯ç‰¹ 7</span>
                <input type="number" class="price" data-type="credit" value="0" min="0">
                <input type="number" class="quantity" data-type="credit" value="0" min="0">
                <input type="number" class="subtotal" data-type="credit" value="0" readonly>
            </div>
        </div>
        <div class="total-area">
            <div>æ•¸é‡ç¸½è¨ˆ: <span id="creditQuantityTotal">0</span></div>
            <div>åˆ·å¡ç¸½åƒ¹: <span id="creditTotal">0</span></div>
        </div>
    </div>

    ---

    <div id="cashSection" class="calculation-section">
        <h2>ğŸ’° ç¾é‡‘è¨ˆç®—</h2>
        <div class="item-row header-row">
            <span>ç”¢å“åç¨±</span>
            <span>åƒ¹æ ¼</span>
            <span>æ•¸é‡</span>
            <span>ç¸½åƒ¹</span>
        </div>
        <div class="item-list" data-type="cash">
            <div class="item-row">
                <span class="product-name">ä¸ƒæ˜Ÿæ¿ƒ</span>
                <input type="number" class="price" data-type="cash" value="0" min="0">
                <input type="number" class="quantity" data-type="cash" value="0" min="0">
                <input type="number" class="subtotal" data-type="cash" value="0" readonly>
            </div>
            <div class="item-row">
                <span class="product-name">ä¸ƒæ˜Ÿä¸­æ·¡</span>
                <input type="number" class="price" data-type="cash" value="0" min="0">
                <input type="number" class="quantity" data-type="cash" value="0" min="0">
                <input type="number" class="subtotal" data-type="cash" value="0" readonly>
            </div>
            <div class="item-row">
                <span class="product-name">ä¸ƒæ˜Ÿè¶…æ·¡</span>
                <input type="number" class="price" data-type="cash" value="0" min="0">
                <input type="number" class="quantity" data-type="cash" value="0" min="0">
                <input type="number" class="subtotal" data-type="cash" value="0" readonly>
            </div>
            <div class="item-row">
                <span class="product-name">ä¸ƒæ˜Ÿè—è“5è™Ÿ</span>
                <input type="number" class="price" data-type="cash" value="0" min="0">
                <input type="number" class="quantity" data-type="cash" value="0" min="0">
                <input type="number" class="subtotal" data-type="cash" value="0" readonly>
            </div>
            <div class="item-row">
                <span class="product-name">ä¸ƒæ˜Ÿè—è“8è™Ÿ</span>
                <input type="number" class="price" data-type="cash" value="0" min="0">
                <input type="number" class="quantity" data-type="cash" value="0" min="0">
                <input type="number" class="subtotal" data-type="cash" value="0" readonly>
            </div>
            <div class="item-row">
                <span class="product-name">å¤©é¦™5è™Ÿ</span>
                <input type="number" class="price" data-type="cash" value="0" min="0">
                <input type="number" class="quantity" data-type="cash" value="0" min="0">
                <input type="number" class="subtotal" data-type="cash" value="0" readonly>
            </div>      
            <div class="item-row">
                <span class="product-name">å¡æ–¯ç‰¹3</span>
                <input type="number" class="price" data-type="cash" value="0" min="0">
                <input type="number" class="quantity" data-type="cash" value="0" min="0">
                <input type="number" class="subtotal" data-type="cash" value="0" readonly>
            </div>
            <div class="item-row">
                <span class="product-name">å¡æ–¯ç‰¹5</span>
                <input type="number" class="price" data-type="cash" value="0" min="0">
                <input type="number" class="quantity" data-type="cash" value="0" min="0">
                <input type="number" class="subtotal" data-type="cash" value="0" readonly>
            </div>
            <div class="item-row">
                <span class="product-name">å¡æ–¯ç‰¹ 7</span>
                <input type="number" class="price" data-type="cash" value="0" min="0">
                <input type="number" class="quantity" data-type="cash" value="0" min="0">
                <input type="number" class="subtotal" data-type="cash" value="0" readonly>
            </div>
        </div>
        <div class="total-area">
            <div>æ•¸é‡ç¸½è¨ˆ: <span id="cashQuantityTotal">0</span></div>
            <div>ç¾é‡‘ç¸½åƒ¹: <span id="cashTotal">0</span></div>
        </div>
    </div>
    
    <div class="grand-total-area">
        <div>
            ç¸½æ•¸é‡: <span id="grandQuantityTotal">0</span>
        </div>
        <div>
            ç¸½é‡‘é¡: <span id="grandTotal">0</span>
        </div>
    </div>
</div>

<script>
    // JavaScript å¯¦ç¾è¨ˆç®—å’ŒåŒ¯å‡ºé‚è¼¯

    // --- è¼”åŠ©å‡½å¼ï¼šå¾ HTML åˆ—è¡¨ä¸­ç²å–è³‡æ–™è¡Œ (ä¿æŒä¸è®Š) ---
    function getSectionData(rows, typeName) {
        let sectionData = '';
        rows.forEach(row => {
            const name = row.querySelector('.product-name').textContent;
            const price = row.querySelector('.price').value;
            const quantity = row.querySelector('.quantity').value;
            const subtotal = row.querySelector('.subtotal').value;
            
            // æ ¼å¼: é¡åˆ¥,ç”¢å“åç¨±,åƒ¹æ ¼,æ•¸é‡,ç¸½åƒ¹
            sectionData += `${typeName},${name},${price},${quantity},${subtotal}\n`;
        });
        return sectionData;
    }

    // --- å±€éƒ¨è¨ˆç®—é‚è¼¯ (æ–°å¢å‘¼å«å…¨åŸŸç¸½è¨ˆ) ---
    function calculateTotal(type) {
        let total = 0;
        let quantityTotal = 0; 
        const priceInputs = document.querySelectorAll(`input.price[data-type="${type}"]`);

        priceInputs.forEach(priceInput => {
            const row = priceInput.closest('.item-row');
            const quantityInput = row.querySelector(`input.quantity[data-type="${type}"]`);
            const subtotalInput = row.querySelector(`input.subtotal[data-type="${type}"]`);
            
            const price = parseFloat(priceInput.value) || 0;
            const quantity = parseInt(quantityInput.value) || 0;
            
            quantityTotal += quantity; 
            const subtotal = price * quantity;
            
            subtotalInput.value = subtotal.toFixed(0); 
            total += subtotal;
        });
        
        // æ›´æ–°ç¸½åƒ¹é¡¯ç¤ºæ¬„ä½
        const totalElement = type === 'credit' ? document.getElementById('creditTotal') : document.getElementById('cashTotal');
        totalElement.textContent = total.toFixed(0);

        // æ›´æ–°æ•¸é‡ç¸½å’Œé¡¯ç¤ºæ¬„ä½
        const quantityTotalElement = type === 'credit' ? document.getElementById('creditQuantityTotal') : document.getElementById('cashQuantityTotal');
        quantityTotalElement.textContent = quantityTotal.toFixed(0);

        // å‘¼å«å…¨åŸŸç¸½è¨ˆæ›´æ–°
        updateGrandTotal();
    }

    // --- å…¨åŸŸç¸½è¨ˆé‚è¼¯ (æ–°å¢) ---
    function updateGrandTotal() {
        // è®€å–åˆ·å¡å’Œç¾é‡‘çš„æ•¸é‡ç¸½å’Œ
        const creditQ = parseInt(document.getElementById('creditQuantityTotal').textContent) || 0;
        const cashQ = parseInt(document.getElementById('cashQuantityTotal').textContent) || 0;
        
        // è®€å–åˆ·å¡å’Œç¾é‡‘çš„é‡‘é¡ç¸½å’Œ
        const creditT = parseFloat(document.getElementById('creditTotal').textContent) || 0;
        const cashT = parseFloat(document.getElementById('cashTotal').textContent) || 0;

        // è¨ˆç®—å…¨åŸŸç¸½è¨ˆ
        const grandQ = creditQ + cashQ;
        const grandT = creditT + cashT;

        // æ›´æ–° HTML é¡¯ç¤º
        document.getElementById('grandQuantityTotal').textContent = grandQ.toFixed(0);
        document.getElementById('grandTotal').textContent = grandT.toFixed(0);
    }
    
    // --- åŒ¯å‡ºé‚è¼¯ (æ–°å¢å…¨åŸŸç¸½è¨ˆåŒ¯å‡º) ---
    function exportToCSV() {
        const timestamp = new Date().toISOString().slice(0, 10).replace(/-/g, '');
        const filename = `å•†å“è¨ˆç®—å ±å‘Š_${timestamp}.csv`;
        
        let csv = "\ufeffé¡åˆ¥,ç”¢å“åç¨±,åƒ¹æ ¼,æ•¸é‡,ç¸½åƒ¹\n"; 

        // 1. åŒ¯å‡ºåˆ·å¡è³‡æ–™åŠç¸½è¨ˆ
        const creditList = document.querySelector('.item-list[data-type="credit"]').querySelectorAll('.item-row');
        csv += getSectionData(creditList, "åˆ·å¡");
        
        const creditTotal = document.getElementById('creditTotal').textContent;
        const creditQuantityTotal = document.getElementById('creditQuantityTotal').textContent;
        csv += `ç¸½è¨ˆ,åˆ·å¡ç¸½åƒ¹,,,${creditTotal}\n`;
        csv += `ç¸½è¨ˆ,åˆ·å¡ç¸½æ•¸é‡,,${creditQuantityTotal},\n`;
        csv += `\n`;

        // 2. åŒ¯å‡ºç¾é‡‘è³‡æ–™åŠç¸½è¨ˆ
        const cashList = document.querySelector('.item-list[data-type="cash"]').querySelectorAll('.item-row');
        csv += getSectionData(cashList, "ç¾é‡‘");
        
        const cashTotal = document.getElementById('cashTotal').textContent;
        const cashQuantityTotal = document.getElementById('cashQuantityTotal').textContent;
        csv += `ç¸½è¨ˆ,ç¾é‡‘ç¸½åƒ¹,,,${cashTotal}\n`;
        csv += `ç¸½è¨ˆ,ç¾é‡‘ç¸½æ•¸é‡,,${cashQuantityTotal},\n`;
        csv += `\n`;

        // 3. åŒ¯å‡ºå…¨åŸŸç¸½è¨ˆ (æ–°å¢)
        const grandTotal = document.getElementById('grandTotal').textContent;
        const grandQuantityTotal = document.getElementById('grandQuantityTotal').textContent;
        csv += `ç¸½çµ,å…¨åŸŸç¸½é‡‘é¡,,,${grandTotal}\n`;
        csv += `ç¸½çµ,å…¨åŸŸç¸½æ•¸é‡,,${grandQuantityTotal},\n`;
        
        // 4. å‰µå»ºä¸‹è¼‰é€£çµä¸¦è§¸ç™¼ä¸‹è¼‰
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        if (link.download !== undefined) { 
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    }


    document.addEventListener('DOMContentLoaded', () => {
        // åˆå§‹è¨ˆç®—å’Œç›£è½è¼¸å…¥
        const inputs = document.querySelectorAll('.price, .quantity');
        inputs.forEach(input => {
            input.addEventListener('input', (event) => {
                const type = event.target.dataset.type;
                calculateTotal(type);
                // ä¸éœ€è¦é¡å¤–å‘¼å« updateGrandTotalï¼Œå› ç‚ºå®ƒå·²ç¶“åŒ…å«åœ¨ calculateTotal è£¡é¢
            });
        });

        // é é¢è¼‰å…¥æ™‚å…ˆè¨ˆç®—ä¸€æ¬¡
        calculateTotal('credit');
        calculateTotal('cash');
        updateGrandTotal(); // ç¢ºä¿åˆå§‹å€¼æ­£ç¢º

        // ç‚ºåŒ¯å‡ºæŒ‰éˆ•æ–°å¢é»æ“Šäº‹ä»¶
        const exportButton = document.getElementById('exportButton');
        exportButton.addEventListener('click', exportToCSV);
    });
</script>

</body>
</html>